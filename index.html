<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 Firmware Upload</title>
<style>
body { font-family: Arial; text-align:center; background:#121212; color:#fff; }
.container { max-width:600px; margin:50px auto; background:#1e1e1e; padding:30px; border-radius:12px; }
h2 { color:#0f62fe; }
input[type=file], button { width:90%; padding:12px; margin:10px 0; border-radius:8px; border:none; }
button { background:#0f62fe; color:#fff; cursor:pointer; font-size:16px; }
button:hover { background:#0353e9; }
p { color:#ccc; }
</style>
</head>
<body>
<div class="container">
<h2>Upload Firmware to GitHub</h2>
<p>Select your `.bin` file and click Upload</p>
<input type="file" id="firmware" accept=".bin"><br>
<button onclick="uploadBin()">Upload to GitHub</button>
<p id="status"></p>
</div>

<script>
async function uploadBin() {
    const fileInput = document.getElementById('firmware');
    if(fileInput.files.length == 0){
        alert("Please select a .bin file!");
        return;
    }
    const file = fileInput.files[0];
    const status = document.getElementById('status');
    status.innerText = "Uploading...";

    // Convert file to base64
    const reader = new FileReader();
    reader.onload = async function() {
        const content = reader.result.split(',')[1]; // remove data:..base64
        const url = "https://api.github.com/repos/subodhpaul22/esp32-ota-web/contents/firmware.bin";
        const token = "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"; // Generate in GitHub Settings -> Developer -> Personal Access Token

        const body = {
            message: "Upload firmware",
            content: content,
            committer: { name: "ESP32 OTA", email: "you@example.com" }
        };

        const response = await fetch(url, {
            method: "PUT",
            headers: {
                "Authorization": "token " + token,
                "Accept": "application/vnd.github.v3+json"
            },
            body: JSON.stringify(body)
        });

        const result = await response.json();
        if(result.content){
            status.innerText = "Upload Successful! File SHA: " + result.content.sha;
        } else {
            console.error(result);
            status.innerText = "Upload Failed! Check console.";
        }
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
